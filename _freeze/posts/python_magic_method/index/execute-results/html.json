{
  "hash": "120e7e5fa007c661e07125030918cc17",
  "result": {
    "markdown": "---\ntitle: Pythonä¸­çš„å‡ ä¸ªé­”æ³•æ–¹æ³•\nauthor: metseq\ndate: '2022-11-31'\ncategories:\n  - Python\ntoc: true\nnumber-sections: true\n---\n\n# ç±»å’Œå¯¹è±¡çš„`__dict__`å±æ€§\n\n## å¯¹è±¡çš„`__dict__`å±æ€§\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nclass Point():\n    '''Create a Point'''\n    my_name = 'A Point'\n    def __init__(self, x, y):\n        self.x = x\n        self.y = y\n```\n:::\n\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\np = Point(3, 4)\np.__dict__\n```\n\n::: {.cell-output .cell-output-display execution_count=2}\n```\n{'x': 3, 'y': 4}\n```\n:::\n:::\n\n\nå¯¹è±¡çš„`__dict__`å±æ€§å°±æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œè¿™ä¸ªå­—å…¸çš„é”®æ˜¯å¯¹è±¡çš„å±æ€§ï¼Œå€¼å°±æ˜¯å¯¹åº”å±æ€§çš„å€¼ã€‚\n\nå½“ç»™å¯¹è±¡å±æ€§å¤åˆ¶çš„æ—¶å€™ï¼Œå°±æ˜¯ä¿®æ”¹`__dict__`å­—å…¸ã€‚\n\n## ç±»çš„`__dict__`å±æ€§\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\nPoint.__dict__\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```\nmappingproxy({'__module__': '__main__',\n              '__doc__': 'Create a Point',\n              'my_name': 'A Point',\n              '__init__': <function __main__.Point.__init__(self, x, y)>,\n              '__dict__': <attribute '__dict__' of 'Point' objects>,\n              '__weakref__': <attribute '__weakref__' of 'Point' objects>})\n```\n:::\n:::\n\n\nå¯ä»¥çœ‹åˆ°ï¼Œ`Point`ç±»çš„`__dict__`å±æ€§åŒ…æ‹¬äº†ï¼š\n- ç±»çš„æ–‡æ¡£`__doc__`\n- ç±»ä¸­å®šä¹‰å˜é‡ï¼Œæ¯”å¦‚è¿™é‡Œçš„`my_name`\n- ç±»çš„æ–¹æ³•\n- å…¶ä»–ä¸€äº›ä¸çŸ¥é“ä»€ä¹ˆçš„ä¸œè¥¿ğŸ˜“\n\n# ç±»çš„`__repr__`å’Œ`__str__`æ–¹æ³•\n\n## `__repr__`æ–¹æ³•\n\nç›´æ¥è¾“å‡º`p`æ—¶ï¼Œä¼šæ˜¾ç¤ºä¸€å †æ²¡ç”¨çš„ä¸œè¥¿\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\np\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```\n<__main__.Point at 0x1b97777e6b0>\n```\n:::\n:::\n\n\næˆ‘ä»¬æƒ³æ˜¾ç¤ºå…³äº`Point`çš„æœ‰ç”¨ä¿¡æ¯ï¼Œè¿™æ—¶`__repr__`æ–¹æ³•å°±æ´¾ä¸Šç”¨åœºäº†\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\nclass Point():\n    def __init__(self, x, y):\n        self.x = x\n        self.y = y\n    \n    def __repr__(self):\n        return \"Point(x=%r, y=%r)\" % (self.x, self.y)\n```\n:::\n\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\np = Point(3, 4)\np\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```\nPoint(x=3, y=4)\n```\n:::\n:::\n\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\nclass Point():\n    def __init__(self, x, y):\n        self.x = x\n        self.y = y\n    \n    def __setattr__(self, name, value):\n        print(f'set attr {name} to float({value})')\n        self.__dict__[name] = float(value)\n    \n    def __repr__(self):\n        return \"Point(x=%r, y=%r)\" % (self.x, self.y)\n```\n:::\n\n\n## `__str__`æ–¹æ³•\n\n`__str__`æ–¹æ³•å’Œ`__repr__`æ–¹æ³•å¥½åƒéƒ½æ˜¯ç”¨å­—ç¬¦è¡¨ç¤ºå¯¹è±¡çš„ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ\n\n[stackoverflow](https://stackoverflow.com/questions/1436703/what-is-the-difference-between-str-and-repr)æœ‰ä¸€ä¸ªå›ç­”è¯´ï¼š\n\n- `__repr__`æ˜¾ç¤ºçš„ä¿¡æ¯éœ€è¦é¿å…æ­§ä¹‰\n- `__str__`æ˜¾ç¤ºçš„ä¿¡æ¯æ³¨é‡å¯è¯»æ€§ï¼Œæ–¹ä¾¿ç†è§£\n- `__str__`ä½¿ç”¨äº†`__repr`\n\n::: {.cell execution_count=8}\n``` {.python .cell-code}\nstr(p)\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```\n'Point(x=3, y=4)'\n```\n:::\n:::\n\n\nåœ¨`Point`ä¸­å¦‚æœæ²¡æœ‰é‡å†™`__str__`æ–¹æ³•ï¼Œä¼šè°ƒç”¨`__repr__`è¾“å‡ºçš„ç»“æœ\n\nå¦‚æœåœ¨`Point`ä¸­é‡å†™äº†`__str__`æ–¹æ³•ï¼Œå°±ä¼šè¾“å‡º`__str__`è°ƒç”¨çš„ç»“æœã€‚\n\n::: {.cell execution_count=9}\n``` {.python .cell-code}\nclass Point():\n    def __init__(self, x, y):\n        self.x = x\n        self.y = y\n    \n    def __repr__(self):\n        return \"Point(x=%r, y=%r)\" % (self.x, self.y)\n    \n    def __str__(self):\n        return f'Just a normal 2d point({self.x}, {self.y})'\n```\n:::\n\n\n::: {.cell execution_count=10}\n``` {.python .cell-code}\np = Point(3, 4)\n```\n:::\n\n\n::: {.cell execution_count=11}\n``` {.python .cell-code}\np\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n```\nPoint(x=3, y=4)\n```\n:::\n:::\n\n\n::: {.cell execution_count=12}\n``` {.python .cell-code}\nrepr(p)\n```\n\n::: {.cell-output .cell-output-display execution_count=12}\n```\n'Point(x=3, y=4)'\n```\n:::\n:::\n\n\n::: {.cell execution_count=13}\n``` {.python .cell-code}\nprint(p)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nJust a normal 2d point(3, 4)\n```\n:::\n:::\n\n\n::: {.cell execution_count=14}\n``` {.python .cell-code}\nstr(p)\n```\n\n::: {.cell-output .cell-output-display execution_count=14}\n```\n'Just a normal 2d point(3, 4)'\n```\n:::\n:::\n\n\n# ç±»çš„`__setattr__`æ–¹æ³•\n\n::: {.cell execution_count=15}\n``` {.python .cell-code}\np = Point('3', '4')\np\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```\nPoint(x='3', y='4')\n```\n:::\n:::\n\n\næƒ³åœ¨åˆå§‹åŒ–Pointçš„æ—¶å€™ï¼ŒæŠŠxï¼Œyå±æ€§è½¬å˜æˆfloatç±»å‹ï¼Œ`__setattr__`æ–¹æ³•å°±èƒ½ç”¨ä¸Šäº†\n\n::: {.cell execution_count=16}\n``` {.python .cell-code}\nclass Point():\n    def __init__(self, x, y):\n        self.x = x\n        self.y = y\n    \n    def __setattr__(self, name, value):\n        self.__dict__[name] = float(value)\n    \n    def __repr__(self):\n        return \"Point(x=%r, y=%r)\" % (self.x, self.y)\n```\n:::\n\n\n::: {.cell execution_count=17}\n``` {.python .cell-code}\np = Point('3', '4')\np\n```\n\n::: {.cell-output .cell-output-display execution_count=17}\n```\nPoint(x=3.0, y=4.0)\n```\n:::\n:::\n\n\n```python\np.__dict__\n```\n\npçš„xå’Œyå±æ€§éƒ½å·²ç»æ˜¯floatç±»å‹äº†ï¼Œè¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ\n\nåœ¨ç±»çš„`__init__`å‡½æ•°ä¸­ï¼Œ`self.x = `xè¿™ä¸€å¥ï¼Œ`self.x`çš„å€¼è®¾ä¸º`x`ï¼Œ\n\nå½“é‡åˆ°è¿™ç§`å¯¹è±¡.å±æ€§ = å€¼`çš„æ—¶å€™ï¼Œå¦‚æœé‡å†™äº†`__setattr__`æ–¹æ³•ï¼Œå°±ä¼šè°ƒç”¨`__setattr__`æ–¹æ³•ï¼Œ\n\nä¹Ÿå°±æ˜¯è¯´å½“é‡åˆ°`å¯¹è±¡.å±æ€§ = å€¼`ï¼Œç›¸å½“äºè°ƒç”¨äº†`__setattr__(å¯¹è±¡, å±æ€§, å€¼)`\n\nåœ¨è¿™é‡Œç›¸å½“äº`__setattr__(self, 'x', x)`ï¼Œåœ¨`__setattr__`å‡½æ•°é‡Œä¿®æ”¹äº†`self.__dict__['x'] = float(value)`\n\n`__setattr__`å‡½æ•°é‡Œé¢å¯ä»¥åšä½ æƒ³åšçš„ä»»ä½•äº‹æƒ…ï¼Œä¸ä»…ä»…æ˜¯æ”¹å˜é»˜è®¤çš„å±æ€§èµ‹å€¼æ“ä½œ\n\n::: {.cell execution_count=18}\n``` {.python .cell-code}\nclass Point():\n    def __init__(self, x, y):\n        self._modules = {}\n        self.x = x\n        self.y = y\n    \n    def __setattr__(self, name, value):\n        if not name.startswith('_'):\n            self._modules[name] = value\n            print(f'add {name}:{value} to _module')\n        print(f'set {name} to {value}')\n        super().__setattr__(name, value)\n        \n    def __repr__(self):\n        return \"Point(x=%r, y=%r)\" % (self.x, self.y)\n```\n:::\n\n\n::: {.cell execution_count=19}\n``` {.python .cell-code}\np = Point(3, 4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nset _modules to {}\nadd x:3 to _module\nset x to 3\nadd y:4 to _module\nset y to 4\n```\n:::\n:::\n\n\n::: {.cell execution_count=20}\n``` {.python .cell-code}\np._modules\n```\n\n::: {.cell-output .cell-output-display execution_count=20}\n```\n{'x': 3, 'y': 4}\n```\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}